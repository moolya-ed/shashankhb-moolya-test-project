import json
import logging
import os

# Setup basic logging
#logging.basicConfig(level=logging.INFO)

#save logs adn view logs- it be todo_manager.log


logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler("todo_manager.log")  # Only saves to a file
    ]
)


# Function to get the absolute path to the todos.json file
def get_default_todo_path():
    base_dir = os.path.dirname(os.path.abspath(__file__))
    return os.path.join(base_dir, "../data/todos.json")

# Function to load todos from a JSON file
def load_list(file_path=None):
    if file_path is None:
        file_path = get_default_todo_path()

    abs_path = os.path.abspath(file_path)
    print(f" Looking for file at: {abs_path}")

    if not os.path.exists(abs_path):#if no file
        logging.warning(f"File '{file_path}' not found. Returning an empty list.")
        return []

    try:
        with open(abs_path, 'r') as file:#open the file in read mode
            todos = json.load(file)#converst json into python
            logging.info(f" Loaded {len(todos)} todos from {file_path}")
            return todos
    except json.JSONDecodeError as e:
        logging.error(f" Error decoding JSON from file '{file_path}': {e}")
        return []
    except Exception as e:
        logging.error(f" An unexpected error occurred: {e}")
        return []

# Function to get details of a specific todo by ID
def get_todo_details(todo_id, file_path=None):
    todos = load_list(file_path)

    for todo in todos:
        if todo["id"] == todo_id:
            logging.info(f" Found todo with ID {todo_id}")
            return todo

    error_message = f" Error: Todo with ID {todo_id} not found. 404 Not Found."
    print(error_message)
    logging.warning(error_message)
    return None

# Function to show menu to user
def show_menu():
    print("\n====== TODO MANAGER ======")
    print("1. View All Todos")
    print("2. Get Todo by ID")
    print("3. Exit")

# Main CLI block
if __name__ == "__main__":
    print(" Welcome to the Todo Manager!")

    while True:#run contnously
        show_menu()
        choice = input("Choose an option (1-3): ")

        if choice == '1':
            todos = load_list()
            print("\n Todos:")
            for todo in todos:
                print(f" - ID {todo['id']}: {todo['title']} [Done: {todo['doneStatus']}]")
        elif choice == '2':
            try:
                todo_id = int(input("Enter the Todo ID: "))
                todo = get_todo_details(todo_id)
                if todo:
                    print(f"\n Todo Details:\n{json.dumps(todo, indent=4)}")#convert python-json with good indent text
            except ValueError:
                print(" Invalid input. Please enter a number.")
        elif choice == '3':
            print(" Exiting Todo Manager. Goodbye!")
            break
        else:
            print(" Invalid choice. Please select a valid option.")
