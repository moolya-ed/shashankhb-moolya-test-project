<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-top: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-top: 40px;
        }

        .section-title {
            font-size: 24px;
            color: #00796b;
            margin-bottom: 10px;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            background-color: #f9f9f9;
        }

        .button {
            background-color: #00796b;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }

        .button:hover {
            background-color: #004d40;
        }

        .todo-list {
            margin-top: 20px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 10px;
            border: 1px solid #ddd;
        }

        .todo-item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        .todo-item:last-child {
            border-bottom: none;
        }

        .notification {
            background-color: #4caf50;
            color: white;
            padding: 10px;
            text-align: center;
            margin-top: 20px;
            display: none;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <h1>Todo Manager</h1>

    <div class="container">
        <!-- Add Todo Section -->
        <div class="section">
            <h2 class="section-title">Add Todo</h2>
            <input type="text" id="addTitle" class="input-field" placeholder="Title"><br>
            <input type="text" id="addDescription" class="input-field" placeholder="Description"><br>
            <button class="button" onclick="addTodo()">Add Todo</button>
        </div>

        <hr>

        <!-- Update Todo Section -->
        <div class="section">
            <h2 class="section-title">Update Todo</h2>
            <input type="text" id="updateTodoId" class="input-field" placeholder="Todo ID"><br>
            <button class="button" onclick="showUpdateFields()">Show Update Fields</button><br>

            <div id="updateFields" style="display:none;">
                <input type="text" id="updateTitle" class="input-field" placeholder="New Title"><br>
                <input type="text" id="updateDescription" class="input-field" placeholder="New Description"><br>
                <label for="updateDoneStatus">Done Status (true/false):</label>
                <input type="text" id="updateDoneStatus" class="input-field" placeholder="true/false"><br>
                <button class="button" onclick="updateTodo()">Update Todo</button>
            </div>
        </div>

        <hr>

        <!-- View Todo by ID Section -->
        <div class="section">
            <h2 class="section-title">View Todo by ID</h2>
            <input type="text" id="viewTodoId" class="input-field" placeholder="Todo ID"><br>
            <button class="button" onclick="viewTodoById()">View Todo</button><br>

            <div id="viewTodoResult"></div> <!-- This will display the result of the view action -->
        </div>

        <hr>

        <!-- Delete Todo Section -->
        <div class="section">
            <h2 class="section-title">Delete Todo</h2>
            <input type="text" id="deleteTodoId" class="input-field" placeholder="Todo ID"><br>
            <button class="button" onclick="deleteTodo()">Delete Todo</button>
        </div>

        <hr>

        <!-- Save Changes Button -->
        <div class="section">
            <button class="button" onclick="saveChanges()">Save Changes</button>
        </div>

        <hr>

        <!-- View All Todos Section -->
        <div class="section">
            <h2 class="section-title">View All Todos</h2>
            <button class="button" onclick="viewAllTodos()">View All Todos</button>

            <div id="todosList" class="todo-list"></div> <!-- This will display all todos -->
        </div>

        <!-- Save Changes Notification -->
        <div id="notification" class="notification">
            <p>Changes saved!</p>
        </div>
    </div>

    <script>
        const apiUrl = "http://127.0.0.1:8000"; // Adjust to your FastAPI backend URL
        let todos = [];

        // Add Todo
        function addTodo() {
            const title = document.getElementById("addTitle").value;
            const description = document.getElementById("addDescription").value;
            const todo = { title, description, doneStatus: false };

            fetch(`${apiUrl}/add_todo`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(todo)
            })
            .then(response => response.json())
            .then(data => {
                alert("Todo added successfully!");
                viewAllTodos(); // Refresh todos after adding
            });
        }

        // Show update fields when a valid ID is entered
        function showUpdateFields() {
            const todoId = document.getElementById("updateTodoId").value;
            if (todoId) {
                document.getElementById("updateFields").style.display = "block";
            } else {
                alert("Please enter a valid Todo ID.");
            }
        }

        // Update Todo
        function updateTodo() {
            const id = document.getElementById("updateTodoId").value;
            const title = document.getElementById("updateTitle").value;
            const description = document.getElementById("updateDescription").value;
            const doneStatus = document.getElementById("updateDoneStatus").value.toLowerCase() === "true";

            const updatedTodo = { title, description, doneStatus };

            fetch(`${apiUrl}/update_todo/${id}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(updatedTodo)
            })
            .then(response => response.json())
            .then(data => {
                alert("Todo updated successfully!");
                viewAllTodos(); // Refresh todos after updating
            });
        }

        // View Todo by ID
        function viewTodoById() {
            const todoId = document.getElementById("viewTodoId").value;

            fetch(`${apiUrl}/todo/${todoId}`)
            .then(response => response.json())
            .then(data => {
                if (data) {
                    document.getElementById("viewTodoResult").innerHTML = `
                        <h3>Todo Details:</h3>
                        <p><strong>ID:</strong> ${data.id}</p>
                        <p><strong>Title:</strong> ${data.title}</p>
                        <p><strong>Description:</strong> ${data.description}</p>
                        <p><strong>Status:</strong> ${data.doneStatus ? "True" : "False"}</p>
                    `;
                }
            })
            .catch(error => {
                document.getElementById("viewTodoResult").innerHTML = "Todo not found.";
            });
        }

        // Delete Todo
        function deleteTodo() {
            const todoId = document.getElementById("deleteTodoId").value;

            fetch(`${apiUrl}/remove_todo/${todoId}`, {
                method: "DELETE"
            })
            .then(response => response.json())
            .then(data => {
                alert("Todo deleted successfully!");
                viewAllTodos(); // Refresh todos after deletion
            });
        }

        // Save Changes
        function saveChanges() {
            console.log('Save Changes button clicked');  // Debugging line
            showNotification();
        }

        // Show notification
        function showNotification() {
            console.log('Showing notification'); // Debugging line
            const notification = document.getElementById("notification");
            notification.style.display = "block";

            setTimeout(() => {
                notification.style.display = "none";
            }, 2000);
        }

        // View All Todos
        function viewAllTodos() {
            fetch(`${apiUrl}/todos`)
            .then(response => response.json())
            .then(data => {
                todos = data;
                const todosList = document.getElementById("todosList");
                todosList.innerHTML = "";

                data.forEach(todo => {
                    todosList.innerHTML += `
                        <div class="todo-item">
                            <p><strong>ID:</strong> ${todo.id}</p>
                            <p><strong>Title:</strong> ${todo.title}</p>
                            <p><strong>Description:</strong> ${todo.description}</p>
                            <p><strong>Status:</strong> ${todo.doneStatus ? "True" : "False"}</p>
                        </div>
                    `;
                });
            });
        }
    </script>

</body>
</html>
